<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ad Pilot - Video Generator</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
padding: 40px 20px;
}

.container {
max-width: 600px;
margin: 0 auto;
background: white;
border-radius: 20px;
padding: 40px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

h1 {
color: #333;
margin-bottom: 10px;
font-size: 32px;
}

.subtitle {
color: #666;
margin-bottom: 30px;
font-size: 16px;
}

.form-group {
margin-bottom: 25px;
}

label {
display: block;
margin-bottom: 8px;
color: #333;
font-weight: 600;
font-size: 14px;
}

.label-description {
font-weight: 400;
color: #666;
font-size: 13px;
margin-top: 4px;
}

input[type="text"],
input[type="email"],
select {
width: 100%;
padding: 12px;
border: 2px solid #e0e0e0;
border-radius: 8px;
font-size: 16px;
transition: border-color 0.3s;
}

input[type="text"]:focus,
input[type="email"]:focus,
select:focus {
outline: none;
border-color: #667eea;
}

/* Checkbox styling */
.checkbox-group {
margin-left: 20px;
padding: 15px;
border-left: 3px solid #667eea;
background: #f8f9ff;
border-radius: 8px;
margin-top: 10px;
}

.checkbox-label {
display: flex;
align-items: center;
cursor: pointer;
}

input[type="checkbox"] {
width: 20px;
height: 20px;
margin-right: 10px;
cursor: pointer;
}

.vehicle-group {
display: flex;
gap: 10px;
margin-bottom: 15px;
align-items: center;
}

.vehicle-group select {
flex: 1;
}

.remove-vehicle {
padding: 12px 16px;
background: #000000;
color: white;
border: none;
border-radius: 8px;
cursor: pointer;
font-size: 18px;
font-weight: 600;
transition: background 0.2s;
}

.remove-vehicle:hover {
background: #333333;
}

.add-vehicle {
width: 100%;
padding: 12px;
background: #f0f0f0;
color: #333;
border: 2px dashed #ccc;
border-radius: 8px;
cursor: pointer;
font-size: 14px;
font-weight: 600;
transition: all 0.2s;
}

.add-vehicle:hover:not(:disabled) {
background: #e0e0e0;
border-color: #999;
}

.add-vehicle:disabled {
opacity: 0.5;
cursor: not-allowed;
}

button[type="submit"] {
width: 100%;
padding: 16px;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
border: none;
border-radius: 8px;
font-size: 18px;
font-weight: 600;
cursor: pointer;
transition: transform 0.2s;
}

button[type="submit"]:hover {
transform: translateY(-2px);
}

button[type="submit"]:active {
transform: translateY(0);
}

button[type="submit"]:disabled {
opacity: 0.5;
cursor: not-allowed;
}

.status {
margin-top: 20px;
padding: 15px;
border-radius: 8px;
display: none;
}

.status.success {
background: #d4edda;
color: #155724;
border: 1px solid #c3e6cb;
}

.status.error {
background: #f8d7da;
color: #721c24;
border: 1px solid #f5c6cb;
}

.status.loading {
background: #d1ecf1;
color: #0c5460;
border: 1px solid #bee5eb;
}

.hidden {
display: none;
}

/* Template badge styling */
.template-badge {
display: inline-block;
padding: 4px 12px;
border-radius: 12px;
font-size: 12px;
font-weight: 600;
margin-left: 8px;
}

.template-badge.multi {
background: #e3f2fd;
color: #1976d2;
}

.template-badge.spotlight {
background: #fff3e0;
color: #e65100;
}
</style>
</head>
<body>
<div class="container">
<h1>üé¨ Ad Pilot Video Generator</h1>
<p class="subtitle">Drive Business, Boost Social Presence</p>

<form id="adForm">
    <!-- Template Selection -->
    <div class="form-group">
        <label for="template">
            Template
            <span class="label-description">Choose your video style</span>
        </label>
        <select id="template" name="template" required onchange="handleTemplateChange()">
            <option value="">Select template...</option>
            <option value="temp_001">üöó Multi-Car Showcase (1-5 cars)</option>
            <option value="temp_002">‚≠ê Single Vehicle Spotlight (premium)</option>
        <option value="temp_003">üí° Capitol Smarts (Organic / Education)</option>
        </select>
    </div>

    <!-- Platform Selection -->
    <div class="form-group hidden" id="platformGroup">
        <label for="platform">
            Platform
            <span class="label-description">Where will this video be posted?</span>
        </label>
        <select id="platform" name="platform" required onchange="checkFormValidity()">
            <option value="">Select platform...</option>
            <option value="tiktok">TikTok</option>
            <option value="youtube">YouTube Shorts</option>
            <option value="instagram">Instagram Reels</option>
            <option value="facebook">Facebook Reels</option>
        </select>
    </div>

    <!-- Avatar Selection -->
    <div class="form-group hidden" id="avatarGroup">
        <label for="avatar">
        Avatar Presenter
        </label>
        <select id="avatar" name="avatar" required>
            <option value="">Select avatar...</option>
            <option value="229bfc03d4d24d5ab7a5c71ce4b10d4b|bWI0w7QVOZiBvlJQahML|#89be5a|22|Shad">üé≠ Awesome Shad</option>
            <option value="5b9c75a2f13e4d60b09bcfdafa7339dd|eezuv0zKVdVTS0jHdxFa|#6da264|8|Kelly">üíÉ Sexy Kelly, not Kelly</option>
            <option value="f9bb73f75160463ea82fe93f71592fce|xvBFrvpBNGBaCHOlL3IP|#7fc741|29|Gary">üòå Calm Gary Knight</option>
        </select>
    </div>

    <!-- Target Length (show early for temp_003) -->
    <div class="form-group hidden" id="lengthGroup">
        <label for="scriptLength" title="TikTok: 15-30s | Instagram Reels: 20-40s | YouTube Shorts: 30-60s | Facebook Reels: 30-60s" style="cursor: help;">
            Target Length ‚ÑπÔ∏è
            <span class="label-description">How detailed should the script be?</span>
        </label>
        <select id="scriptLength" name="script_length" required onchange="handleLengthChange()">
            <option value="">Select length...</option>
            <option value="quick">Brief (~15-30 sec)</option>
            <option value="standard">Standard (~30-45 sec)</option>
            <option value="detailed">Detailed (~45-60 sec)</option>
        </select>
    </div>

    <!-- Educational Topic Section (only shows after length selected for temp_003) -->
    <div class="form-group hidden" id="topicGroup">
        <label>Capitol Smarts Topic
            <span class="label-description">What should the video be about?</span>
        </label>
        <fieldset style="padding:20px;background-color:#f8f8f8">
            <label for="topic">
                Create your own
                <span class="label-description">Specify a topic.</span>
            </label>
            <input type="text" id="topic" name="topic" placeholder="e.g., What to check before buying a used car" required="required">
            
            <div style="text-align: left; margin: 15px; color: #000; font-weight: 600; font-size: 18px;">OR</div>
            
            <label>
                Let us help
                <span class="label-description">We make suggestions for you.</span>
            </label>
            
            <!-- Radio buttons for suggestion mode -->
            <div style="margin-top: 10px; margin-bottom: 15px;">
                <label style="display: flex; align-items: center; margin-bottom: 10px; cursor: pointer; font-weight: 400;">
                    <input type="radio" name="suggestionMode" value="lucky" checked onchange="handleSuggestionModeChange()" style="margin-right: 8px;">
                    <span>I'm feeling lucky</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer; font-weight: 400;">
                    <input type="radio" name="suggestionMode" value="guided" onchange="handleSuggestionModeChange()" style="margin-right: 8px;">
                    <span>Give me topics about...</span>
                </label>
            </div>
            
            <!-- Topic Guidance input (hidden unless "guided" mode selected) -->
            <div id="topicGuidanceContainer" style="display: none; margin-bottom: 15px;">
                <input type="text" id="topicGuidance" name="topic_guidance" oninput="handleGuidanceChange()" placeholder="e.g., winter driving, Thanksgiving travel, financing" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
            </div>
            
            <!-- Suggest Topics Button -->
            <div style="margin-bottom: 15px;">
                <button type="button" id="suggestTopicsBtn" onclick="suggestTopics()" style="padding: 5px 12px 7px 12px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">
                    üí° Suggest Topics
                </button>
            </div>
            
            <!-- Suggestions Display -->
            <div id="topicSuggestions" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9ff; border-radius: 8px; border-left: 4px solid #667eea;">
                <div style="font-size: 13px; color: #666; margin-bottom: 10px; font-weight: 600;">Click a suggestion to use it:</div>
                <div id="suggestionsList"></div>
            </div>
        </fieldset>
    </div>


    <div class="form-group hidden" id="themeGroup">
        <label for="theme">
            Theme (Optional)
            <span class="label-description">e.g., Summer Blowout, Back to School, Harvest Deals</span>
        </label>
        <input type="text" id="theme" name="theme" placeholder="Leave blank for generic ad">
    </div>

    <!-- Include Animation Checkbox (HIDDEN - coming soon!) -->
    <div class="checkbox-group hidden" id="animationGroup" style="display: none !important;">
        <label class="checkbox-label">
            <input type="checkbox" id="includeAnimation" name="include_animation" value="false">
            <span>
                <strong>Include theme animation</strong>
                <div class="label-description">Adds a 2-second animated intro based on your theme</div>
            </span>
        </label>
    </div>

    <!-- Email -->
    <div class="form-group hidden" id="emailGroup">
        <label for="email">
            Email Address
            <span class="label-description">We'll send the finished video here</span>
        </label>
        <input type="email" id="email" name="email" required placeholder="your.email@example.com">
    </div>

    <!-- Vehicles -->
    <div class="form-group hidden" id="vehiclesGroup">
        <label id="vehicleLabel">Vehicles (1-5)</label>
        <div id="vehicleContainer">
            <!-- Vehicle groups added dynamically -->
        </div>
        <button type="button" id="addVehicleBtn" class="add-vehicle" onclick="addVehicle()" disabled>
            + Add Vehicle (max 5)
        </button>
    </div>

    <!-- Submit Button -->
    <button type="submit" id="submitBtn" disabled>
        üöÄ Generate Ad
    </button>

    <!-- Status Messages -->
    <div id="status" class="status"></div>
</form>
</div>

<script>
const WEBHOOK_URL = 'https://corsproxy.io/?https://kelly-ads.app.n8n.cloud/webhook/ad-pilot';
const TOPIC_SUGGEST_URL = 'https://corsproxy.io/?https://kelly-ads.app.n8n.cloud/webhook/topic-suggest';
const INVENTORY_SHEET = 'https://docs.google.com/spreadsheets/d/1kgSVMgpWVSFeAAz4M2LpNmIbuhaJKds9gnbsvLdP-t4/gviz/tq?tqx=out:json&sheet=Feed';
let MAX_CARS = 5; // Will change based on template

let vehicleCount = 0;
let inventory = [];
let selectedTemplate = '';

// Animation option hidden for now - coming soon!
// (Theme still works to influence the script)

function handleTemplateChange() {
    selectedTemplate = document.getElementById('template').value;
    
    const themeGroup = document.getElementById('themeGroup');
    const topicGroup = document.getElementById('topicGroup');
    const emailGroup = document.getElementById('emailGroup');
    const platformGroup = document.getElementById('platformGroup');
    const vehiclesGroup = document.getElementById('vehiclesGroup');
    const lengthGroup = document.getElementById('lengthGroup');
    const avatarGroup = document.getElementById('avatarGroup');
    const addBtn = document.getElementById('addVehicleBtn');
    const vehicleLabel = document.getElementById('vehicleLabel');
    
    // First, hide everything
    themeGroup.classList.add('hidden');
    topicGroup.classList.add('hidden');
    vehiclesGroup.classList.add('hidden');

    // common
    emailGroup.classList.add('hidden');
    platformGroup.classList.add('hidden');
    lengthGroup.classList.add('hidden');
    avatarGroup.classList.add('hidden');

    // If no template selected, stop here
    if (!template) return;

    // Show common fields for all templates
    emailGroup.classList.remove('hidden');
    platformGroup.classList.remove('hidden');
    lengthGroup.classList.remove('hidden');
    avatarGroup.classList.remove('hidden');
    
    if (selectedTemplate === 'temp_002') {
        // Template 2: Single vehicle only
        MAX_CARS = 1;
        vehicleLabel.textContent = 'Vehicle (1)';
        addBtn.textContent = '+ Add 1 Vehicle';
        addBtn.disabled = true;
        
        // Remove extra vehicles if any
        while (vehicleCount > 1) {
        const lastGroup = document.querySelector(`[data-vehicle-num="${vehicleCount}"]`);
        if (lastGroup) lastGroup.remove();
            vehicleCount--;
        }
        themeGroup.classList.remove('hidden');
        vehiclesGroup.classList.add('hidden');
        
        // Make vehicle selects required again
        const vehicleSelects = document.querySelectorAll('#vehicleContainer select');
        vehicleSelects.forEach(select => select.required = true);
    
    } else if (selectedTemplate === 'temp_001') {
        // Template 1: 1-5 vehicles
        MAX_CARS = 5;
        vehicleLabel.textContent = 'Vehicles (1-5)';
        addBtn.textContent = '+ Add Vehicle (max 5)';
        addBtn.disabled = vehicleCount >= MAX_CARS || vehicleCount === 0;

        themeGroup.classList.remove('hidden');
        vehiclesGroup.classList.add('hidden');
        
        // Make vehicle selects required again
        const vehicleSelects = document.querySelectorAll('#vehicleContainer select');
        vehicleSelects.forEach(select => select.required = true);
        
    } else if (selectedTemplate == 'temp_003') {
        // Template 3: Organic/Education - no vehicles needed
        // Don't show topicGroup yet - wait for length selection
        vehiclesGroup.classList.add('hidden');
        
        // Remove required from any existing vehicle selects
        const vehicleSelects = document.querySelectorAll('#vehicleContainer select');
        vehicleSelects.forEach(select => select.required = false);
    }
    
    // Enable submit button check
    checkFormValidity();
}

async function loadInventory() {
    try {
        const response = await fetch(INVENTORY_SHEET);
        const text = await response.text();
        const json = JSON.parse(text.substr(47).slice(0, -2));
        
        inventory = json.table.rows.slice(1).map(row => {
        const cells = row.c;
        return {
        // Corrected Indices
        vin: cells[1]?.v || '',      // Column B
        make: cells[4]?.v || '',     // Column E
        model: cells[5]?.v || '',    // Column F
        year: cells[6]?.v || '',     // Column G
        price: cells[14]?.v || ''    // Assumes price is in Column O
    };
}).filter(car => car.vin && car.year && car.make && car.model);

// Sort by year descending (newest first)
inventory.sort((a, b) => b.year - a.year);

console.log(`Loaded ${inventory.length} vehicles from inventory`);

// Add first vehicle dropdown
addVehicle();

} catch (error) {
console.error('Error loading inventory:', error);
showStatus('Error loading vehicle inventory. Please refresh the page.', 'error');
}
}

function addVehicle() {
if (vehicleCount >= MAX_CARS) return;

vehicleCount++;
const container = document.getElementById('vehicleContainer');
const vehicleGroup = document.createElement('div');
vehicleGroup.className = 'vehicle-group';
vehicleGroup.dataset.vehicleNum = vehicleCount;

const select = document.createElement('select');
select.name = `vehicle${vehicleCount}`;
select.required = selectedTemplate !== 'temp_003'; // Only required if NOT organic/education
select.onchange = checkFormValidity;

const defaultOption = document.createElement('option');
defaultOption.value = '';
defaultOption.textContent = 'Select vehicle...';
select.appendChild(defaultOption);

vehicleGroup.appendChild(select);

// Add remove button (hide for first vehicle)
if (vehicleCount > 1) {
const removeBtn = document.createElement('button');
removeBtn.type = 'button';
removeBtn.className = 'remove-vehicle';
removeBtn.textContent = '‚àí';
removeBtn.onclick = () => removeVehicle(vehicleCount);
vehicleGroup.appendChild(removeBtn);
}

container.appendChild(vehicleGroup);
populateVehicleDropdowns();
checkFormValidity();
}

function populateVehicleDropdowns() {
const selects = document.querySelectorAll('#vehicleContainer select');
const selectedVins = Array.from(selects).map(s => s.value).filter(v => v);

selects.forEach(select => {
const currentValue = select.value;
select.innerHTML = '<option value="">Select vehicle...</option>';

inventory.forEach(car => {
if (!selectedVins.includes(car.vin) || car.vin === currentValue) {
const option = document.createElement('option');
option.value = car.vin;
option.textContent = `${car.year} ${car.make} ${car.model}, ${car.price} - ${car.vin}`;
select.appendChild(option);
}
});

if (currentValue) {
select.value = currentValue;
}
});

const addBtn = document.getElementById('addVehicleBtn');
    if (selectedTemplate === 'temp_002') {
        addBtn.disabled = true; // Always disabled for Template 2
    } else {
        addBtn.disabled = vehicleCount >= MAX_CARS;
    }
}

function removeVehicle(num) {
if (vehicleCount <= 1) return;

const vehicleGroup = document.querySelector(`[data-vehicle-num="${num}"]`);
vehicleGroup.remove();
vehicleCount--;

// Renumber remaining vehicles
const groups = document.querySelectorAll('.vehicle-group');
groups.forEach((group, index) => {
const newNum = index + 1;
group.dataset.vehicleNum = newNum;
const select = group.querySelector('select');
select.name = `vehicle${newNum}`;
const button = group.querySelector('.remove-vehicle');
if (button) {
button.onclick = () => removeVehicle(newNum);
}
});

vehicleCount = groups.length;
populateVehicleDropdowns();
}

function checkFormValidity() {
    const template = document.getElementById('template').value;
    const topic = document.getElementById('topic').value;
    const avatar = document.getElementById('avatar').value;
    const platform = document.getElementById('platform').value;
    const scriptLength = document.getElementById('scriptLength').value;
    const email = document.getElementById('email').value;
    const selects = document.querySelectorAll('#vehicleContainer select');
    const hasVehicles = Array.from(selects).some(s => s.value);
    const submitBtn = document.getElementById('submitBtn');
    // Different validation for temp_003 vs others
    if (template === 'temp_003') {
        submitBtn.disabled = !(template && topic && platform && scriptLength && avatar && email);
    } else {
        submitBtn.disabled = !(template && platform && scriptLength && avatar && email && hasVehicles);
    }
}

document.getElementById('adForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const template = formData.get('template');
    const topic = formData.get('topic');
    const platform = formData.get('platform');
    const theme = formData.get('theme') || '';
    const includeAnimation = formData.get('include_animation') === 'true';
    const avatarValue = formData.get('avatar');
    const email = formData.get('email');
    const scriptLength = formData.get('script_length');
    
    // Parse avatar (format: avatar_id|voice_id|chromakey_color|chromakey_sensitivity)
    const [avatar_id, voice_id, chromakey_color, chromakey_sensitivity, avatar_name] = avatarValue.split('|');
    
    const vins = [];
    for (let i = 1; i <= vehicleCount; i++) {
        const vin = formData.get(`vehicle${i}`);
        if (vin) vins.push(vin);
    }

    // Only validate vehicles if NOT temp_003
    if (template !== 'temp_003') {
        if (vins.length === 0) {
            showStatus('Please select at least one vehicle', 'error');
            return;
        }
    }

    if (template === 'temp_002' && vins.length > 1) {
        showStatus('Template 2 only supports 1 vehicle', 'error');
        return;
    }

    const payload = {
        template_id: template.toUpperCase(), // TEMP_001, TEMP_002, or TEMP_003
        theme: theme,
        topic: topic,
        platform: platform,
        include_animation: includeAnimation,
        avatar_id: avatar_id,
        voice_id: voice_id,
        chromakey_color: chromakey_color,
        chromakey_sensitivity: chromakey_sensitivity,
        avatar_name: avatar_name,
        script_length: scriptLength,
        email: email,
        vins: vins
    };

console.log('Submitting payload:', payload);

showStatus(`Generating your ad... This will take 10 minutes or less. ‚è±Ô∏è`, 'loading');

// Disable submit button
document.getElementById('submitBtn').disabled = true;

try {
    const response = await fetch(WEBHOOK_URL, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify(payload)
});

const result = await response.json();

if (response.ok) {
    showStatus(`Success! Your ad is being generated. Check your email in a few minutes. üé¨`, 'success');
    // Re-enable submit after 5 seconds
    setTimeout(() => {
    document.getElementById('submitBtn').disabled = false;
}, 5000);
} else {
showStatus(`Error: ${result.message || 'Something went wrong'}`, 'error');
document.getElementById('submitBtn').disabled = false;
}
} catch (error) {
console.error('Submission error:', error);
showStatus(`Error: ${error.message}`, 'error');
document.getElementById('submitBtn').disabled = false;
}
});

function showStatus(message, type) {
const statusDiv = document.getElementById('status');
statusDiv.textContent = message;
statusDiv.className = `status ${type}`;
statusDiv.style.display = 'block';

if (type !== 'loading') {
setTimeout(() => {
statusDiv.style.display = 'none';
}, 5000);
}
}

async function suggestTopics() {
    const scriptLength = document.getElementById('scriptLength').value;
    const avatarName = document.getElementById('avatar').value.split("|").pop();
    const suggestionMode = document.querySelector('input[name="suggestionMode"]:checked').value;
    const topicGuidance = document.getElementById('topicGuidance').value.trim();
    const suggestBtn = document.getElementById('suggestTopicsBtn');
    const suggestionsDiv = document.getElementById('topicSuggestions');
    const suggestionsList = document.getElementById('suggestionsList');
    
    // Map UI values to API values
    const lengthMap = {
        'quick': 'brief_15_30',
        'standard': 'standard_30_45',
        'detailed': 'detailed_45_60'
    };
    
    const targetLength = lengthMap[scriptLength];
    
    // Only use guidance if in "guided" mode
    const guidanceText = suggestionMode === 'guided' ? topicGuidance : '';
    
    // Disable button and show loading
    suggestBtn.disabled = true;
    suggestBtn.textContent = '‚è≥ Generating...';
    
    try {
        const response = await fetch(TOPIC_SUGGEST_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                target_length: targetLength,
                topic_guidance: guidanceText,
                avatar_name: avatarName
            })
        });
        
        const result = await response.json();
        
        if (response.ok && result.success) {
            // Display suggestions
            suggestionsList.innerHTML = result.suggestions.map(topic => 
                `<div style="padding: 10px; margin-bottom: 8px; background: white; border-radius: 6px; cursor: pointer; border: 2px solid #e0e0e0; transition: all 0.2s;" 
                     onmouseover="this.style.borderColor='#667eea'; this.style.background='#f8f9ff';" 
                     onmouseout="this.style.borderColor='#e0e0e0'; this.style.background='white';"
                     onclick="document.getElementById('topic').value = '${topic.replace(/'/g, "\\'")}'; document.getElementById('topicSuggestions').style.display='none';">
                    ${topic}
                </div>`
            ).join('');
            
            suggestionsDiv.style.display = 'block';
        } else {
            showStatus('Failed to generate suggestions. Please try again.', 'error');
        }
    } catch (error) {
        console.error('Suggestion error:', error);
        showStatus('Error generating suggestions. Please try again.', 'error');
    } finally {
        // Re-enable button
        suggestBtn.disabled = false;
        if (topicGuidance.length > 1) {
            suggestBtn.textContent = 'üí° Suggest more topics related to ' + topicGuidance;
        } else {
            suggestBtn.textContent = 'üí° Suggest more topics';
        }
    }
}

function handleSuggestionModeChange() {
    const mode = document.querySelector('input[name="suggestionMode"]:checked').value;
    const guidanceContainer = document.getElementById('topicGuidanceContainer');
    
    if (mode === 'guided') {
        guidanceContainer.style.display = 'block';
    } else {
        guidanceContainer.style.display = 'none';
    }
}

function handleGuidanceChange() {
    const topicGuidance = document.getElementById('topicGuidance').value.trim();
    const suggestBtn = document.getElementById('suggestTopicsBtn');
    
    if (topicGuidance.length > 0) {
        suggestBtn.textContent = 'üí° Suggest topics related to ' + topicGuidance;
    } else {
        suggestBtn.textContent = 'üí° Suggest topics';
    }
}

function handleLengthChange() {
    const template = document.getElementById('template').value;
    const scriptLength = document.getElementById('scriptLength').value;
    const topicGroup = document.getElementById('topicGroup');

    const avatar = document.getElementById('avatar').value;
    
    // Only show topic group for temp_003 after length is selected
    if (template === 'temp_003' && scriptLength && avatar) {
        topicGroup.classList.remove('hidden');
    } else if (template === 'temp_003') {
        topicGroup.classList.add('hidden');
    }
    
    checkFormValidity();
}

// Add event listeners for form validation
document.getElementById('avatar').addEventListener('change', checkFormValidity);
document.getElementById('platform').addEventListener('change', checkFormValidity);
document.getElementById('email').addEventListener('input', checkFormValidity);
document.getElementById('scriptLength').addEventListener('change', checkFormValidity);

// Initialize on page load
loadInventory();
</script>
</body>
</html>





